#!/bin/bash
# ovirt optimizer configuration script
# this script dependent on net-tools package

Get_IP(){
   IPADDR=`ifconfig eth0 | grep inet | head -1 | awk '{print $2}' | cut -d ":" -f 2`
}

Get_Hostname(){
   HOSTNAME=`hostname`
}

Get_Password(){
   read -sp "Please enter the password for the engine user admin@internal: " ADMINPASSWD
}

Configuration_System_Service(){
   echo ""
   echo "Adding service to auto start"
   chkconfig --add ovirt-optimizer
   echo "Restarting httpd"
   /etc/init.d/httpd restart
   echo "Staring service..."
   /etc/rc.d/init.d/ovirt-optimizer start
   chkconfig ovirt-optimizer on
}

Setup(){
   Get_IP
   Get_Password
   sed -i "s/org.ovirt.optimizer.sdk.server=.*/org.ovirt.optimizer.sdk.server=$IPADDR/g" /etc/ovirt-optimizer/ovirt-optimizer.properties
   sed -i "s/org.ovirt.optimizer.sdk.username=.*/org.ovirt.optimizer.sdk.username=admin@internal/g" /etc/ovirt-optimizer/ovirt-optimizer.properties
   sed -i "s/org.ovirt.optimizer.sdk.password=.*/org.ovirt.optimizer.sdk.password=$ADMINPASSWD/g" /etc/ovirt-optimizer/ovirt-optimizer.properties
   sed -i "s/\"baseurl\":.*\//\"baseurl\": \"https:\/\/$HOSTNAME\/ovirt-optimizer\/result\//g" /etc/ovirt-engine/ui-plugins/ovirt-optimizer-config.json
   echo
   Configuration_System_Service
   echo "Setup proccess completed."
}

Setup
